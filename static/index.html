<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi IA - Hub de Modelos</title>
    <style>
        /* El cuerpo ahora permite más ancho, pero el contenido se centrará */
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 2em auto; 
            padding: 0 1em; 
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            align-items: center; /* Centra los bloques hijos */
        }
        
        /* El formulario se queda en 600px */
        .card { 
            border: 1px solid #ddd; 
            padding: 20px; 
            border-radius: 8px; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 600px; 
            box-sizing: border-box;
        }

        select, input, button { 
            padding: 0.8em; 
            margin: 0.5em 0; 
            width: 100%; 
            border-radius: 5px; 
            border: 1px solid #ccc; 
            box-sizing: border-box; 
        }

        button { background-color: #007bff; color: white; border: none; cursor: pointer; font-weight: bold; }
        button:hover { background-color: #0056b3; }
        button:disabled { 
            background-color: #ccc; 
            cursor: default; }

        /* La respuesta ahora es independiente y más ancha */
        #answer { 
            margin-top: 1.5em; 
            padding: 1.5em; 
            /* Quitamos el borde azul izquierdo */
            border: 1px solid #eee; 
            background-color: #f9f9f9; 
            white-space: pre-wrap; 
            min-height: 50px; 
            border-radius: 5px;
            /* Control de ancho independiente */
            width: 100%;
            max-width: 1000px; 
        }

        .loader { color: #555; font-style: italic; }



    </style>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
    <div class="card">
        <h1>Centro de Mando IA</h1>
        
        <label for="modelSelect">Elegir cerebro:</label>
        <select id="modelSelect">
            <option value="gemini">Gemini (GET - Rápido)</option>
            <option value="gemini_post">Gemini 2 (POST - Preguntas largas)</option>
            <option value="openai">OpenAI (POST) &lt;NO FUNCIONA&gt;</option>
            <option value="torgpt">TorGPT (GET) &lt;NO FUNCIONA&gt;</option>
        </select>

        <input type="text" id="question" placeholder="Escribe tu consulta técnica aquí...">
        
        <button id="sendBtn" onclick="sendQuestion()">Enviar Pregunta</button>
    </div>

    <div id="answer">La respuesta aparecerá aquí...</div>

    <script>

        async function sendQuestion() {
            const questionInput = document.getElementById("question");
            const model = document.getElementById("modelSelect").value;
            const answerDiv = document.getElementById("answer");
            const btn = document.getElementById("sendBtn");

            const BASE_URL = "https://backend-ia-fastapi.onrender.com";
            
            
            if (!questionInput.value) return;

            // Bloqueamos UI mientras carga
            answerDiv.innerHTML = '<span class="loader">Consultando a la IA... esto puede tardar unos segundos...</span>';
            btn.disabled = true;

            try {
                let response;
                let url = "";

                // Lógica de ruteo según el modelo seleccionado
                if (model === "gemini") {
                    url = `${BASE_URL}/askGemini?question=${encodeURIComponent(questionInput.value)}`;
                    response = await fetch(url);
                } 
                else if (model === "torgpt") {
                    url = `/ask_Tor_GPT?question=${encodeURIComponent(questionInput.value)}`;
                    response = await fetch(url);
                }
                else if (model === "openai" || model === "gemini_post") {
                    // Estos usan POST y cuerpo JSON
                    url = model === "openai" 
                        ? `${BASE_URL}/ask_OpenAI` 
                        : `${BASE_URL}/ask_Gemini_Post`;

                    response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ question: questionInput.value })
                    });
                }

                const data = await response.json();
                
                // Manejo de la respuesta (depende de cómo devuelva los datos tu API)
                // Si viene de OpenAI/Gemini_Post usamos data.answer, si es TorGPT usamos data.text
                const finalAnswer = data.answer || data.text || JSON.stringify(data);
                answerDiv.innerHTML = marked.parse(finalAnswer);

            } catch (e) {
                answerDiv.innerText = "Error crítico: No se pudo conectar con el backend.";
                console.error(e);
            } finally {
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>

<!-- This is the pattern for fetching de post questions
async function sendQuestion() {
    const question = document.getElementById("question").value;
    const model = document.getElementById("modelSelect").value;
    const answerDiv = document.getElementById("answer");

    if (!question) return;

    answerDiv.innerHTML = 'Consultando...';

    try {
        const response = await fetch("/ask", {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ question }) 
        });

        const data = await response.json();
        
        // El frontend ya sabe que siempre recibirá .answer
        answerDiv.innerHTML = marked.parse(data.answer);

    } catch (e) {
        answerDiv.innerText = "Error de conexión.";
    }
} 
-->